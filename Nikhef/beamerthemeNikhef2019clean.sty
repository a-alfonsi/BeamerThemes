\RequirePackage{tikz, FiraSans, changepage}
\usepackage{transparent}
% \usepackage[UKenglish]{datetime}
\usepackage[en-GB,showdow=false]{datetime2}
\DeclareRobustCommand{\textsquarebullet}{%
  \makebox[1em]{\vrule height 1.1ex depth -.15ex width 1.0ex}%
}
% \usepackage[sfdefault]{FiraSans}
% \usepackage[ultralight]{FiraSans}
\newcommand\firaligth{\fontfamily[ultralight]{FiraSans}\selectfont}

% Command to make less opaque pictures on white background
\newcommand<>{\uncovergraphics}[2][{}]{
    \begin{tikzpicture}
    \node[anchor=south west,inner sep=0] (B) at (4,0)
        {\includegraphics[#1]{#2}};
    \only<1>{%
        \fill [draw=none, fill=white, fill opacity=0.7] (B.north west) -- (B.north east) -- (B.south east) -- (B.south west) -- (B.north west) -- cycle;
    }
    \end{tikzpicture}
}


\DTMlangsetup[en-GB]{ord=raise,monthyearsep={\space}}

\usepackage[absolute,overlay]{textpos}
% To see textboxes
% \usepackage[absolute,overlay,showboxes]{textpos}
% \textblockrulecolour{red}

\DeclareOption{setfont}{
  \setmainfont[NormalFont={Fira Sans Light Italic OT},%
               BoldFont={Fira Sans OT},%
               BoldItalicFont={Fira Sans Italic OT}]%
              {Fira Sans Light OT}%
  \setsansfont[ItalicFont={Fira Sans Light Italic OT},%
               BoldFont={Fira Sans OT},%
               BoldItalicFont={Fira Sans Italic OT}]%
              {Fira Sans Light OT}%
	\setmonofont[BoldFont={Fira Mono Medium}]{Fira Mono}%
	\setmonofont[BoldFont={Fira Mono Medium OT}]{Fira Mono OT}%
}

\ProcessOptions





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% THEME COLOURS, FONTS, ITEMS STYLE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% DEFINE COLOURS
\definecolor{NIKHEFyellow}{RGB}{222,209,138}
\definecolor{NIKHEFred}{RGB}{186,52,59}
\definecolor{NIKHEFpurple}{RGB}{94,40,104}
\definecolor{NIKHEFblue}{RGB}{74,168,186}
\definecolor{NIKHEFgreen}{RGB}{60,196,39}
\definecolor{NIKHEFgray}{RGB}{191,191,191}
\definecolor{NIKHEFdarkgray}{RGB}{79,79,79}

\definecolor{MedianBrown}{RGB}{119,95,85}
\definecolor{MedianLightBrown}{RGB}{235,221,195}
\definecolor{MedianLightBlue}{RGB}{148,182,210}
\definecolor{MedianOrange}{RGB}{221,128,71}
\definecolor{MedianLightOrange}{RGB}{216,178,92}
\definecolor{MedianUltraLightOrange}{RGB}{245,236,215}

% RESET MARGINS
\setbeamersize{text margin left=1cm,text margin right=1cm} 

% DEFINE ELEMENTS COLOURS
\setbeamercolor*{title page header}{fg=black}
\setbeamercolor*{subtitle page header}{fg=NIKHEFgray}
\setbeamercolor*{title}{fg=black}
\setbeamercolor*{author}{fg=NIKHEFdarkgray}
\setbeamercolor*{date}{fg=NIKHEFgray}
\setbeamercolor*{page number}{fg=NIKHEFgray}
\setbeamercolor*{item}{fg=NIKHEFdarkgray}
\setbeamercolor*{frametitle}{fg=black}
\setbeamercolor*{block title}{fg=NIKHEFred, bg=white}
\setbeamercolor*{block title example}{fg=NIKHEFblue, bg=white}
\setbeamercolor*{block body}{bg=white}
\setbeamercolor*{block body example}{bg=white}
\setbeamercolor*{section in toc}{fg=black}
\setbeamercolor*{section page}{fg=white}

% DEFINE BEAMER FONTS
\setbeamerfont{section page}{size=\Large}
\setbeamerfont{title}{size=\Large}
\setbeamerfont{subtitle}{size=\normalsize,series=\normalfont}
\setbeamerfont{author}{size=\normalsize}
\setbeamerfont{date}{size=\normalsize}
\setbeamerfont{footline}{size=\small}

% DEFINE BEAMER ITEMS
\setbeamertemplate{navigation symbols}{}
%Itemize
\setbeamertemplate{items}[square]
% \setbeamertemplate{itemize item}{\tikz{\draw[color=black, semithick] rectangle(.2,.2);}}
\setbeamertemplate{itemize item}{\textsquarebullet }
\setbeamertemplate{itemize subitem}[triangle]
\setbeamertemplate{itemize subsubitem}{\textemdash}
% Enumerate
% \setbeamertemplate{itemize/enumerate body end}{\vspace{1em}}
\setbeamertemplate{enumerate item}{
	\usebeamercolor[bg]{item projected}
	\raisebox{1.5pt}{{\color{NIKHEFblue}\footnotesize\textbf{\insertenumlabel.} }}
}
\setbeamertemplate{sections/subsections in toc}[square]

\newenvironment{xplainframe}{\bgroup\setbeamertemplate{background}{}\begin{frame}[plain]}{\end{frame}\egroup}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PAGES LAYOUT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% DEFINE PAGES BACKGROUNDS

\setbeamertemplate{background}{
  \begin{tikzpicture}
  \useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
  \ifbeamer@plainframe
  \else
  \ifnum\thepage>1\relax
	  % Nikhef colorful line
	  \fill[color=NIKHEFred]    (                0cm,8.45) rectangle(0.7/4, 8.55cm);
	  \fill[color=NIKHEFyellow] (0.7/4,8.45) rectangle(0.7/2, 8.55cm); 
	  \fill[color=NIKHEFpurple] (0.7/2,8.45) rectangle(3*0.7/4, 8.55cm); 
	  \fill[color=NIKHEFblue] (3*0.7/4,8.45) rectangle(0.7 , 8.55cm);  
	  \fill[color=NIKHEFgray] (1,8.45) rectangle(\paperwidth-1cm, 8.5cm);  
  \else
   	% Title page
	  % Nikhef colorful line
	  \fill[color=NIKHEFred]    (                1.3cm,5.05) rectangle(0.9\textwidth/4 + 1.3cm, 5.1);
	  \fill[color=NIKHEFyellow] (0.9\textwidth/4+1.3cm,5.05) rectangle(0.9\textwidth/2 + 1.3cm, 5.1); 
	  \fill[color=NIKHEFpurple] (0.9\textwidth/2+1.3cm,5.05) rectangle(3*0.9\textwidth/4+1.3cm, 5.1); 
	  \fill[color=NIKHEFblue] (3*0.9\textwidth/4+1.3cm,5.05) rectangle(0.9\textwidth +   1.3cm, 5.1);   
  \fi
  \fi
  \end{tikzpicture}
}


% DEFINE TITLE PAGE CONTENT

% Title page
\setbeamertemplate{title page}{
	% Title
	\begin{textblock*}{0.9\textwidth}(1.3cm,1.8cm)
		\begin{beamercolorbox}[wd=\dimexpr\textwidth\relax,ht=1.8cm,dp=0pt]{title page header}%
  		% \vbox to2.5cm{\vfil\usebeamerfont{title}\inserttitle{}{\hskip0pt plus1filll}{}\vfil}%
  		\usebeamerfont{title}\inserttitle
		\end{beamercolorbox}
	\end{textblock*}
	% Subtitle and date
	\begin{textblock*}{0.9\textwidth}(1.3cm,3.8cm)
    \begin{beamercolorbox}[wd=\dimexpr\textwidth\relax]{date}
      \usebeamerfont{subtitle}\insertsubtitle$\;\;-\;\;$\insertdate
	  \end{beamercolorbox}
  \end{textblock*}
  % Author
  \begin{textblock*}{0.9\textwidth}(1.3cm,5cm)
	  \begin{beamercolorbox}{author}
	    \usebeamerfont{author}\insertauthor%
   	\end{beamercolorbox}
  \end{textblock*}
  % Nikhef logo
  \begin{textblock*}{\dimexpr\paperwidth-1.3cm}(1.3cm,\dimexpr\paperheight-2cm\relax)
  	{\uncovergraphics<2->[height=1cm]{Nikhef-logo-black-1.png}}
    \hspace{1cm}
    {\uncovergraphics<2->[height=1cm]{ATLAS-Logo.png}}
  \end{textblock*}
}


% DEFINE SECTION PAGE CONTENT

% Section page
\setbeamertemplate{section page}{
	\begin{tikzpicture}
			\useasboundingbox (1.7,-2) rectangle(\the\paperwidth,\the\paperheight);
			\fill[color=black] (0,0) rectangle (\the\paperwidth,\the\paperheight);
	  % Nikhef colorful line
	  \fill[color=NIKHEFred] (0,0.35) rectangle(\the\paperwidth/4,0.5);
	  \fill[color=NIKHEFyellow] (\the\paperwidth/4,0.35) rectangle(\the\paperwidth/2,0.5); 
	  \fill[color=NIKHEFpurple] (\the\paperwidth/2,0.35) rectangle(3*\the\paperwidth/4,0.5); 
	  \fill[color=NIKHEFblue] (3*\the\paperwidth/4,0.35) rectangle(\the\paperwidth,0.5); 
	\end{tikzpicture}

	\begin{textblock*}{\textwidth}(1.cm,4cm)
		\begin{beamercolorbox}{title page header}
			\insertsectionhead
		\end{beamercolorbox}
	\end{textblock*}
}

% Separation frame (used for section titles)
\newcommand{\sepframe}[1]{
  \begin{frame}[noframenumbering,plain]
  \begin{adjustwidth}{-1cm}{-1cm}
  	\begin{tikzpicture}
  		\useasboundingbox (0,0) rectangle(\the\paperwidth,\the\paperheight);
  		\node[font=\Large\color{black},text width=10cm] at (current page.center) {\uppercase\expandafter{#1}};
	  % Nikhef colorful line
	  \fill[color=NIKHEFred]    (                1.3cm,4.15) rectangle(0.9\textwidth/4 + 1.3cm, 4.2);
	  \fill[color=NIKHEFyellow] (0.9\textwidth/4+1.3cm,4.15) rectangle(0.9\textwidth/2 + 1.3cm, 4.2); 
	  \fill[color=NIKHEFpurple] (0.9\textwidth/2+1.3cm,4.15) rectangle(3*0.9\textwidth/4+1.3cm, 4.2); 
	  \fill[color=NIKHEFblue] (3*0.9\textwidth/4+1.3cm,4.15) rectangle(0.9\textwidth +   1.3cm, 4.2);  
  	\end{tikzpicture}	
	\end{adjustwidth}
	\end{frame}
}


% DEFINE FRAME CONTENT

% Frame title
\setbeamertemplate{frametitle}{
	% Slide number
	\begin{textblock*}{0.7cm}(0.08cm,0.53cm)
		\begin{beamercolorbox}{page number}
			\centering
			\normalsize
			{\fontfamily{lmss}\selectfont 
				\textbf{\insertframenumber}
			}
		\end{beamercolorbox}
	\end{textblock*}
	% Title
	\begin{textblock*}{\textwidth}(1.cm,0.46cm)
		\begin{beamercolorbox}{frametitle}
			\insertframetitle
		\end{beamercolorbox}
	\end{textblock*}
	\vspace{1cm}
}

